<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Tableau de Bord Créateur - Predikta</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="stylecreator.css">
   
</head>
<body>

<!-- Mobile Header -->
<header class="mobile-header" id="mobileHeader">
    <div class="mobile-brand">
        <div class="mobile-brand-icon"><i class="fas fa-chart-line"></i></div>
        Predikta
    </div>
    <div class="mobile-actions">
        <button class="icon-btn" onclick="toggleNotifPanel()">
            <i class="fas fa-bell"></i>
            <span class="badge-dot" id="badgeDot" style="display:none;"></span>
        </button>
        <button class="icon-btn" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
        </button>
    </div>
</header>

<!-- Overlays -->
<div class="overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
<div class="overlay" id="notifOverlay" onclick="closeNotifPanel()"></div>

<!-- Notification Panel -->
<div class="notif-panel" id="notifPanel">
    <div class="notif-head">
        <div class="notif-title"><i class="fas fa-bell"></i> Notifications</div>
        <button class="modal-close" onclick="closeNotifPanel()"><i class="fas fa-times"></i></button>
    </div>
    <div class="notif-list" id="notifList">
        <div class="empty">
            <i class="fas fa-bell-slash"></i>
            <p>Aucune notification</p>
        </div>
    </div>
</div>

<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-top">
            <a class="brand" href="#">
                <div class="brand-icon"><i class="fas fa-chart-line"></i></div>
                <span class="brand-name">Predikta</span>
            </a>
            <div class="user-card">
                <div class="avatar" id="userAvatar">A</div>
                <div class="user-meta">
                    <div class="user-name" id="userName">Admin</div>
                    <div class="user-badge"><i class="fas fa-crown"></i> Créateur</div>
                </div>
            </div>
        </div>

        <nav class="nav">
            <div class="nav-label">Menu</div>
            <a class="nav-link active" onclick="showTab('overview'); closeSidebar();">
                <div class="icon"><i class="fas fa-home"></i></div>
                Vue d'ensemble
            </a>
            <a class="nav-link" onclick="showTab('events'); closeSidebar();">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                Événements
            </a>
            <a class="nav-link" onclick="showTab('results'); closeSidebar();">
                <div class="icon"><i class="fas fa-trophy"></i></div>
                Résultats
            </a>
            <a class="nav-link" onclick="showTab('users'); closeSidebar();">
                <div class="icon"><i class="fas fa-users"></i></div>
                Utilisateurs
            </a>
            <a class="nav-link" onclick="showTab('deposits'); closeSidebar();">
                <div class="icon"><i class="fas fa-money-bill-wave"></i></div>
                Dépôts
            </a>

            <div class="nav-label">Gestion</div>
            <a class="nav-link" href="anit.html" target="_blank">
                <div class="icon"><i class="fas fa-cog"></i></div>
                Page Anit
            </a>
        </nav>

        <div class="sidebar-bottom">
            <button class="btn-logout" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i>
                Déconnexion
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
        <div class="content">

            <!-- Page Header -->
            <div class="page-header">
                <h1 class="page-title">Tableau de <span>bord Créateur</span></h1>
                <div class="header-right">
                    <button class="icon-btn" id="desktopNotifBtn" onclick="toggleNotifPanel()" style="display:flex;">
                        <i class="fas fa-bell"></i>
                        <span class="badge-dot" id="badgeDotDesktop" style="display:none;"></span>
                    </button>
                    <button class="btn btn-primary" onclick="openEventModal()">
                        <i class="fas fa-plus"></i>
                        Nouvel événement
                    </button>
                </div>
            </div>

            <!-- Commission Banner -->
            <div class="commission-banner">
                <div class="commission-left">
                    <div class="commission-icon"><i class="fas fa-coins"></i></div>
                    <div>
                        <div class="commission-label">Commission Predikta</div>
                        <div class="commission-value" id="totalCommission">0 FCFA</div>
                        <div class="commission-desc">2% sur le pot des perdants — gains garantis</div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card purple">
                    <div class="stat-icon-wrap purple"><i class="fas fa-users"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statUsers">0</div>
                        <div class="stat-lbl">Utilisateurs</div>
                    </div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon-wrap green"><i class="fas fa-calendar-check"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statEvents">0</div>
                        <div class="stat-lbl">Événements actifs</div>
                    </div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-icon-wrap orange"><i class="fas fa-ticket-alt"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statBets">0</div>
                        <div class="stat-lbl">Total paris</div>
                    </div>
                </div>
                <div class="stat-card blue">
                    <div class="stat-icon-wrap blue"><i class="fas fa-coins"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statPot">0</div>
                        <div class="stat-lbl">Pot total (FCFA)</div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-bar">
                <button class="tab-btn active" onclick="showTab('overview')">Vue d'ensemble</button>
                <button class="tab-btn" onclick="showTab('events')">Événements</button>
                <button class="tab-btn" onclick="showTab('results')">Résultats</button>
                <button class="tab-btn" onclick="showTab('users')">Utilisateurs</button>
                <button class="tab-btn" onclick="showTab('deposits')">Dépôts</button>
            </div>

            <!-- ── Overview ── -->
            <div class="tab-pane active" id="overviewPane">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-fire"></i> Événements récents</div>
                            <button class="btn btn-ghost btn-sm" onclick="showTab('events')">Voir tout</button>
                        </div>
                        <div id="recentEventsList">
                            <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title"><i class="fas fa-money-bill-wave"></i> Derniers dépôts</div>
                            <button class="btn btn-ghost btn-sm" onclick="showTab('deposits')">Voir tout</button>
                        </div>
                        <div id="recentDepositsList">
                            <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ── Events ── -->
            <div class="tab-pane" id="eventsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-calendar-alt"></i> Tous les événements</div>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Question</th>
                                    <th>Catégorie</th>
                                    <th>OUI</th>
                                    <th>NON</th>
                                    <th>Pot</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTableBody">
                                <tr><td colspan="8" style="text-align:center;padding:2rem;color:var(--text-muted);">Chargement…</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ── Results ── -->
            <div class="tab-pane" id="resultsPane">
                <div class="card" style="margin-bottom:1.25rem;">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-trophy"></i> Événements en attente</div>
                    </div>
                    <div id="pendingResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-history"></i> Résultats annoncés</div>
                    </div>
                    <div id="announcedResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
            </div>

            <!-- ── Users ── -->
            <div class="tab-pane" id="usersPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-users"></i> Tous les utilisateurs</div>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th><th>Nom</th><th>Pseudo</th><th>Contact</th><th>Solde</th><th>Paris</th><th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <tr><td colspan="7" style="text-align:center;padding:2rem;color:var(--text-muted);">Chargement…</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ── Deposits ── -->
            <div class="tab-pane" id="depositsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-money-bill-wave"></i> Tous les dépôts</div>
                    </div>
                    <div class="table-wrap">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th><th>Utilisateur</th><th>Montant</th><th>Date</th><th>Statut</th><th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="depositsTableBody">
                                <tr><td colspan="6" style="text-align:center;padding:2rem;color:var(--text-muted);">Chargement…</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div><!-- /content -->
    </main>
</div><!-- /layout -->

<!-- ── Event Modal ── -->
<div class="modal-overlay" id="eventModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Créer un événement</div>
            <button class="modal-close" onclick="closeEventModal()"><i class="fas fa-times"></i></button>
        </div>
        <form id="eventForm" onsubmit="createEvent(event)">
            <div class="form-group">
                <label class="form-label">Question *</label>
                <input type="text" class="form-control" id="eventQuestion" placeholder="Ex: Le Sénégal va-t-il gagner la CAN ?" required>
            </div>
            <div class="form-group">
                <label class="form-label">Catégorie *</label>
                <select class="form-control" id="eventCategory" required>
                    <option value="sport">Sport</option>
                    <option value="politique">Politique</option>
                    <option value="entertainment">Divertissement</option>
                    <option value="crypto">Crypto</option>
                    <option value="autre">Autre</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Mise minimale (FCFA) *</label>
                <input type="number" class="form-control" id="eventMinBet" value="100" min="100" required>
            </div>
            <div class="form-group">
                <label class="form-label">Date de fin *</label>
                <input type="datetime-local" class="form-control" id="eventEndDate" required>
            </div>
            <div class="form-group">
                <label class="form-label">Description (optionnel)</label>
                <textarea class="form-control" id="eventDescription" placeholder="Description de l'événement…"></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-full" id="createEventBtn">
                <i class="fas fa-plus"></i> Créer l'événement
            </button>
        </form>
    </div>
</div>

<!-- ── Result Modal ── -->
<div class="modal-overlay" id="resultModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Annoncer le résultat</div>
            <button class="modal-close" onclick="closeResultModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="summary-box" id="resultEventSummary"></div>
        <div class="form-group">
            <label class="form-label">Sélectionnez le résultat gagnant</label>
            <div class="result-opts">
                <div class="result-opt yes-opt" onclick="selectResult('yes')">
                    <i class="fas fa-check-circle"></i>
                    <h4>OUI</h4>
                    <p>Les parieurs OUI gagnent</p>
                </div>
                <div class="result-opt no-opt" onclick="selectResult('no')">
                    <i class="fas fa-times-circle"></i>
                    <h4>NON</h4>
                    <p>Les parieurs NON gagnent</p>
                </div>
            </div>
        </div>
        <div id="resultPreview" style="display:none;">
            <div class="summary-box">
                <div class="summary-row">
                    <span class="summary-key">Gagnants</span>
                    <span class="summary-val" id="winnersCount" style="color:var(--success);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Perdants</span>
                    <span class="summary-val" id="losersCount" style="color:var(--danger);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Pot redistribué</span>
                    <span class="summary-val" id="redistributionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Commission (2%)</span>
                    <span class="summary-val" id="commissionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Gain par gagnant</span>
                    <span class="summary-val" id="gainPerWinner" style="color:var(--success);">0 FCFA</span>
                </div>
            </div>
        </div>
        <button class="btn btn-success btn-full" onclick="confirmResult()" id="confirmResultBtn" disabled>
            <i class="fas fa-trophy"></i> Confirmer le résultat
        </button>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMsg">Message</span>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-messaging-compat.js"></script>
<script type="module" src="creator.js"></script>

