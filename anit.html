<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Anit - Gestion Predikta</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
      <link rel="stylesheet" href="styleanit.css">

</head>
<body>

<!-- Mobile Header -->
<header class="mobile-header">
    <div class="mobile-brand">
        <div class="mobile-brand-icon"><i class="fas fa-chart-line"></i></div>
        <div class="mobile-brand-text">Predikta — <span>Anit</span></div>
    </div>
    <button class="icon-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
</header>

<!-- Overlay -->
<div class="overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<!-- Image Modal -->
<div class="modal-overlay" id="imageModal">
    <div class="modal-img-wrap">
        <button class="modal-close" onclick="closeImageModal()" style="position:absolute;top:0.75rem;right:0.75rem;z-index:1;">
            <i class="fas fa-times"></i>
        </button>
        <img class="modal-image" id="modalImage" src="" alt="Capture">
    </div>
</div>

<!-- Result Modal -->
<div class="modal-overlay" id="resultModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Annoncer le résultat</div>
            <button class="modal-close" onclick="closeResultModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="summary-box" id="resultEventSummary"></div>
        <div class="form-group">
            <label class="form-label">Résultat gagnant</label>
            <div class="result-opts">
                <div class="result-opt yes-opt" onclick="selectResult('yes')">
                    <i class="fas fa-check-circle"></i>
                    <h4>OUI</h4>
                    <p>Les parieurs OUI gagnent</p>
                </div>
                <div class="result-opt no-opt" onclick="selectResult('no')">
                    <i class="fas fa-times-circle"></i>
                    <h4>NON</h4>
                    <p>Les parieurs NON gagnent</p>
                </div>
            </div>
        </div>
        <div id="resultPreview" style="display:none;">
            <div class="summary-box">
                <div class="summary-row">
                    <span class="summary-key">Gagnants</span>
                    <span class="summary-val" id="winnersCount" style="color:var(--success);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Perdants</span>
                    <span class="summary-val" id="losersCount" style="color:var(--danger);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Pot redistribué</span>
                    <span class="summary-val" id="redistributionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Commission (2%)</span>
                    <span class="summary-val" id="commissionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Gain par gagnant</span>
                    <span class="summary-val" id="gainPerWinner" style="color:var(--success);">0 FCFA</span>
                </div>
            </div>
        </div>
        <button class="btn btn-success btn-full" onclick="confirmResult()" id="confirmResultBtn" disabled>
            <i class="fas fa-trophy"></i> Confirmer le résultat
        </button>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMsg">Message</span>
</div>

<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-top">
            <a class="brand" href="#">
                <div class="brand-icon"><i class="fas fa-chart-line"></i></div>
                <div class="brand-name">Predikta <span>Anit</span></div>
            </a>
        </div>

        <nav class="nav">
            <div class="nav-label">Menu</div>
            <a class="nav-link active" onclick="showTab('deposits'); closeSidebar();">
                <div class="icon"><i class="fas fa-money-bill-wave"></i></div>
                Dépôts à valider
            </a>
            <a class="nav-link" onclick="showTab('new-deposit'); closeSidebar();">
                <div class="icon"><i class="fas fa-plus-circle"></i></div>
                Nouveau dépôt
            </a>
            <a class="nav-link" onclick="showTab('events'); closeSidebar();">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                Événements
            </a>
            <a class="nav-link" onclick="showTab('results'); closeSidebar();">
                <div class="icon"><i class="fas fa-trophy"></i></div>
                Résultats
            </a>

            <div class="nav-label">Navigation</div>
            <a class="nav-link back-link" href="predikta-dashboard.html">
                <div class="icon"><i class="fas fa-arrow-left"></i></div>
                Retour au dashboard
            </a>
        </nav>
    </aside>

    <!-- Main -->
    <main class="main">
        <div class="content">

            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Page <span>Anit</span></h1>
                    <div class="page-sub">Gestion des dépôts, événements et résultats</div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card purple">
                    <div class="stat-icon-wrap purple"><i class="fas fa-clock"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statPending">0</div>
                        <div class="stat-lbl">En attente</div>
                    </div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon-wrap green"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statApproved">0</div>
                        <div class="stat-lbl">Approuvés</div>
                    </div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-icon-wrap orange"><i class="fas fa-coins"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statTotal">0</div>
                        <div class="stat-lbl">Total FCFA</div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-bar">
                <button class="tab-btn active" onclick="showTab('deposits')">Dépôts</button>
                <button class="tab-btn" onclick="showTab('new-deposit')">Nouveau dépôt</button>
                <button class="tab-btn" onclick="showTab('events')">Événements</button>
                <button class="tab-btn" onclick="showTab('results')">Résultats</button>
            </div>

            <!-- ── Deposits ── -->
            <div class="tab-pane active" id="depositsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-money-bill-wave"></i> Dépôts en attente</div>
                        <button class="btn btn-ghost btn-sm" onclick="loadPendingDeposits()">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                    </div>
                    <div class="deposits-grid" id="pendingDepositsList">
                        <div class="empty" style="grid-column:1/-1;">
                            <i class="fas fa-circle-notch fa-spin"></i>
                            <p>Chargement…</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ── New Deposit ── -->
            <div class="tab-pane" id="new-depositPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-plus-circle"></i> Confirmer un dépôt</div>
                    </div>
                    <div class="alert-banner">
                        <i class="fas fa-info-circle"></i>
                        <span>Remplissez ce formulaire pour soumettre un dépôt manuel au nom d'un utilisateur.</span>
                    </div>
                    <form id="depositForm" onsubmit="submitDeposit(event)" class="form-wrap">
                        <div class="form-group">
                            <label class="form-label">Utilisateur *</label>
                            <select class="form-control" id="depositUser" required>
                                <option value="">Sélectionner un utilisateur</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Montant (FCFA) *</label>
                            <input type="number" class="form-control" id="depositAmount" placeholder="Ex: 5000" min="500" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nom complet *</label>
                            <input type="text" class="form-control" id="depositName" placeholder="Nom et prénom" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact *</label>
                            <input type="tel" class="form-control" id="depositContact" placeholder="Numéro de téléphone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Capture d'écran *</label>
                            <div class="upload-zone" onclick="openCloudinaryWidget()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Cliquez pour uploader</h4>
                                <p>PNG, JPG ou WEBP acceptés</p>
                            </div>
                            <div class="upload-preview" id="uploadPreview" style="display:none;">
                                <img id="previewImage" src="" alt="Preview">
                            </div>
                            <input type="hidden" id="screenshotUrl">
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="submitDepositBtn">
                            <i class="fas fa-paper-plane"></i> Soumettre le dépôt
                        </button>
                    </form>
                </div>
            </div>

            <!-- ── Events ── -->
            <div class="tab-pane" id="eventsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-calendar-alt"></i> Publier un événement</div>
                    </div>
                    <form id="eventForm" onsubmit="publishEvent(event)" class="form-wrap">
                        <div class="form-group">
                            <label class="form-label">Question *</label>
                            <input type="text" class="form-control" id="eventQuestion" placeholder="Ex: Le Sénégal va-t-il gagner la CAN 2024 ?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Catégorie *</label>
                            <select class="form-control" id="eventCategory" required>
                                <option value="sport">Sport</option>
                                <option value="politique">Politique</option>
                                <option value="entertainment">Divertissement</option>
                                <option value="crypto">Crypto</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mise minimale (FCFA) *</label>
                            <input type="number" class="form-control" id="eventMinBet" value="100" min="100" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date de clôture *</label>
                            <input type="datetime-local" class="form-control" id="eventEndDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description (optionnel)</label>
                            <textarea class="form-control" id="eventDescription" placeholder="Description détaillée…"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success btn-full" id="publishEventBtn">
                            <i class="fas fa-calendar-plus"></i> Publier l'événement
                        </button>
                    </form>
                </div>
            </div>

            <!-- ── Results ── -->
            <div class="tab-pane" id="resultsPane">
                <div class="card" style="margin-bottom:1.25rem;">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-trophy"></i> Événements en attente de résultat</div>
                    </div>
                    <div id="pendingResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-history"></i> Résultats annoncés</div>
                    </div>
                    <div id="announcedResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
            </div>

        </div><!-- /content -->
    </main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script type="module" src="anit.js"></script>


