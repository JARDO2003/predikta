<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Anit - Gestion Predikta</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
    <style>
        :root {
            --primary: #7c3aed;
            --primary-light: #a855f7;
            --primary-glow: rgba(124,58,237,0.35);
            --accent: #f43f5e;
            --accent-light: #fb7185;
            --success: #10b981;
            --success-glow: rgba(16,185,129,0.3);
            --danger: #f43f5e;
            --danger-glow: rgba(244,63,94,0.3);
            --warning: #f59e0b;
            --info: #0ea5e9;
            --bg: #07080f;
            --bg-card: #0d0f1e;
            --bg-elevated: #121428;
            --bg-hover: #181b33;
            --border: rgba(255,255,255,0.07);
            --border-glow: rgba(124,58,237,0.3);
            --text: #f0f0ff;
            --text-muted: #6b7094;
            --text-dim: #9399c2;
            --grad: linear-gradient(135deg, #7c3aed 0%, #f43f5e 100%);
            --grad-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --grad-danger: linear-gradient(135deg, #f43f5e 0%, #dc2626 100%);
            --grad-warm: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            --sidebar-w: 260px;
            --header-h: 60px;
            --radius: 14px;
            --radius-sm: 8px;
            --radius-lg: 20px;
            --shadow: 0 8px 32px rgba(0,0,0,0.4);
        }

        *, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }

        body::before {
            content:'';
            position:fixed; inset:0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
            pointer-events:none; z-index:0; opacity:0.4;
        }

        /* ── LAYOUT ── */
        .layout { display:flex; min-height:100vh; }

        /* ── SIDEBAR ── */
        .sidebar {
            width: var(--sidebar-w);
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: fixed; top:0; left:0; bottom:0;
            display: flex; flex-direction: column;
            z-index: 200;
            transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
            overflow-y: auto; scrollbar-width: none;
        }
        .sidebar::-webkit-scrollbar { display:none; }

        .sidebar-top {
            padding: 1.5rem 1.25rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        .brand {
            display: flex; align-items: center; gap: 0.75rem;
            text-decoration: none; margin-bottom: 1rem;
        }
        .brand-icon {
            width:38px; height:38px;
            background: var(--grad);
            border-radius:10px;
            display:flex; align-items:center; justify-content:center;
            font-size:1rem; color:#fff;
            box-shadow: 0 4px 16px var(--primary-glow);
            flex-shrink:0;
        }
        .brand-name {
            font-family:'Syne',sans-serif;
            font-size:1.1rem; font-weight:800;
        }
        .brand-name span {
            background: var(--grad);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            background-clip:text;
        }

        .nav { padding:1rem 0.875rem; flex:1; }
        .nav-label {
            font-size:0.65rem; text-transform:uppercase;
            letter-spacing:0.08em; color:var(--text-muted);
            padding:0 0.5rem; margin-bottom:0.5rem; margin-top:1rem;
        }
        .nav-label:first-child { margin-top:0; }

        .nav-link {
            display:flex; align-items:center; gap:0.75rem;
            padding:0.7rem 0.875rem;
            color:var(--text-dim); text-decoration:none;
            border-radius:var(--radius-sm);
            font-size:0.875rem; font-weight:500;
            cursor:pointer; transition:all 0.2s;
            margin-bottom:0.125rem; border:1px solid transparent;
        }
        .nav-link:hover { background:var(--bg-hover); color:var(--text); }
        .nav-link.active {
            background: linear-gradient(135deg,rgba(124,58,237,0.18) 0%,rgba(244,63,94,0.08) 100%);
            color:var(--text); border-color:var(--border-glow);
        }
        .nav-link .icon {
            width:32px; height:32px; border-radius:8px;
            display:flex; align-items:center; justify-content:center;
            font-size:0.8rem; flex-shrink:0;
            background:rgba(255,255,255,0.05); transition:all 0.2s;
        }
        .nav-link.active .icon, .nav-link:hover .icon {
            background:rgba(124,58,237,0.2); color:var(--primary-light);
        }
        .nav-link.back-link { color:var(--text-muted); }
        .nav-link.back-link:hover { color:var(--accent-light); }

        .sidebar-bottom {
            padding:1rem 0.875rem;
            border-top:1px solid var(--border);
        }

        /* ── MOBILE HEADER ── */
        .mobile-header {
            display:none;
            position:fixed; top:0; left:0; right:0;
            height:var(--header-h);
            background:rgba(13,15,30,0.95);
            backdrop-filter:blur(20px);
            -webkit-backdrop-filter:blur(20px);
            border-bottom:1px solid var(--border);
            align-items:center; justify-content:space-between;
            padding:0 1rem; z-index:300;
        }
        .mobile-brand {
            display:flex; align-items:center; gap:0.625rem;
            font-family:'Syne',sans-serif; font-size:1rem; font-weight:800;
        }
        .mobile-brand-icon {
            width:30px; height:30px; background:var(--grad);
            border-radius:8px; display:flex; align-items:center;
            justify-content:center; font-size:0.8rem; color:#fff; flex-shrink:0;
        }
        .mobile-brand-text span {
            background:var(--grad);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            background-clip:text;
        }
        .icon-btn {
            width:36px; height:36px; background:var(--bg-elevated);
            border:1px solid var(--border); border-radius:var(--radius-sm);
            color:var(--text); display:flex; align-items:center;
            justify-content:center; cursor:pointer; transition:all 0.2s;
            font-size:0.875rem;
        }
        .icon-btn:hover { border-color:var(--border-glow); }

        .overlay {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,0.6); z-index:190;
            backdrop-filter:blur(4px);
        }
        .overlay.active { display:block; }

        /* ── MAIN ── */
        .main { margin-left:var(--sidebar-w); flex:1; min-height:100vh; }
        .content { padding:2rem; max-width:1400px; }

        /* ── PAGE HEADER ── */
        .page-header {
            display:flex; align-items:center; justify-content:space-between;
            margin-bottom:1.75rem; gap:1rem; flex-wrap:wrap;
        }
        .page-title {
            font-family:'Syne',sans-serif;
            font-size:1.625rem; font-weight:800;
        }
        .page-title span {
            background:var(--grad);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            background-clip:text;
        }
        .page-sub { font-size:0.8rem; color:var(--text-muted); margin-top:0.25rem; }

        /* ── STATS GRID ── */
        .stats-grid {
            display:grid;
            grid-template-columns:repeat(3,1fr);
            gap:1rem; margin-bottom:1.75rem;
        }
        .stat-card {
            background:var(--bg-card); border:1px solid var(--border);
            border-radius:var(--radius); padding:1.25rem;
            display:flex; align-items:center; gap:1rem;
            transition:all 0.25s; position:relative; overflow:hidden;
        }
        .stat-card::before {
            content:''; position:absolute;
            top:0; left:0; right:0; height:2px;
            opacity:0; transition:opacity 0.25s;
        }
        .stat-card:hover { border-color:var(--border-glow); transform:translateY(-2px); }
        .stat-card:hover::before { opacity:1; }
        .stat-card.purple::before { background:var(--grad); }
        .stat-card.green::before { background:var(--grad-success); }
        .stat-card.orange::before { background:var(--grad-warm); }

        .stat-icon-wrap {
            width:44px; height:44px; border-radius:10px;
            display:flex; align-items:center; justify-content:center;
            font-size:1rem; flex-shrink:0;
        }
        .stat-icon-wrap.purple { background:rgba(124,58,237,0.15); color:var(--primary-light); }
        .stat-icon-wrap.green { background:rgba(16,185,129,0.15); color:var(--success); }
        .stat-icon-wrap.orange { background:rgba(245,158,11,0.15); color:var(--warning); }

        .stat-info { min-width:0; }
        .stat-val {
            font-family:'Syne',sans-serif;
            font-size:1.375rem; font-weight:700; line-height:1.2;
        }
        .stat-lbl { font-size:0.75rem; color:var(--text-muted); margin-top:0.2rem; }

        /* ── TABS ── */
        .tabs-bar {
            display:flex; gap:0.25rem;
            background:var(--bg-card); border:1px solid var(--border);
            border-radius:var(--radius); padding:0.375rem;
            margin-bottom:1.5rem; overflow-x:auto; scrollbar-width:none;
        }
        .tabs-bar::-webkit-scrollbar { display:none; }
        .tab-btn {
            flex:1; min-width:max-content;
            padding:0.6rem 1rem; background:transparent; border:none;
            border-radius:var(--radius-sm); color:var(--text-muted);
            font-size:0.8rem; font-weight:600; cursor:pointer;
            transition:all 0.2s; white-space:nowrap;
            font-family:'DM Sans',sans-serif;
        }
        .tab-btn.active {
            background:var(--bg-elevated); color:var(--text);
            box-shadow:0 2px 8px rgba(0,0,0,0.3);
        }
        .tab-pane { display:none; }
        .tab-pane.active { display:block; }

        /* ── CARD ── */
        .card {
            background:var(--bg-card); border:1px solid var(--border);
            border-radius:var(--radius-lg); padding:1.5rem;
        }
        .card-header {
            display:flex; align-items:center; justify-content:space-between;
            margin-bottom:1.25rem; gap:0.75rem; flex-wrap:wrap;
        }
        .card-title {
            font-family:'Syne',sans-serif;
            font-size:1rem; font-weight:700;
            display:flex; align-items:center; gap:0.5rem;
        }
        .card-title i { color:var(--primary-light); font-size:0.9rem; }

        /* ── DEPOSITS GRID ── */
        .deposits-grid {
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(min(100%,340px),1fr));
            gap:1.25rem;
        }

        /* ── DEPOSIT CARD ── */
        .dep-card {
            background:var(--bg-elevated); border:1px solid var(--border);
            border-radius:var(--radius); padding:1.25rem;
            transition:all 0.25s; display:flex; flex-direction:column; gap:1rem;
        }
        .dep-card:hover { border-color:var(--border-glow); transform:translateY(-3px); }

        .dep-top {
            display:flex; align-items:center;
            justify-content:space-between; gap:0.75rem; flex-wrap:wrap;
        }
        .dep-user {
            display:flex; align-items:center; gap:0.75rem; min-width:0; flex:1;
        }
        .dep-avatar {
            width:42px; height:42px; background:var(--grad);
            border-radius:50%; display:flex; align-items:center;
            justify-content:center; font-family:'Syne',sans-serif;
            font-weight:700; font-size:0.95rem; color:#fff; flex-shrink:0;
        }
        .dep-user-info { min-width:0; }
        .dep-name {
            font-weight:600; font-size:0.9rem;
            white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
        }
        .dep-email {
            font-size:0.75rem; color:var(--text-muted);
            white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
        }
        .dep-amount {
            font-family:'Syne',sans-serif;
            font-size:1.25rem; font-weight:800;
            color:var(--success); white-space:nowrap; flex-shrink:0;
        }

        .dep-details {
            background:rgba(7,8,15,0.5); border:1px solid var(--border);
            border-radius:var(--radius-sm); padding:0.875rem;
            display:flex; flex-direction:column; gap:0.5rem;
        }
        .dep-detail {
            display:flex; justify-content:space-between; align-items:center;
            font-size:0.82rem; gap:1rem;
        }
        .dep-key { color:var(--text-muted); flex-shrink:0; }
        .dep-val { font-weight:600; text-align:right; word-break:break-word; }

        .dep-screenshot {
            width:100%; height:160px; object-fit:cover;
            border-radius:var(--radius-sm); cursor:pointer;
            transition:all 0.25s; border:1px solid var(--border);
        }
        .dep-screenshot:hover { transform:scale(1.02); border-color:var(--border-glow); }

        .dep-actions { display:flex; gap:0.625rem; }

        /* ── BUTTONS ── */
        .btn {
            display:inline-flex; align-items:center; gap:0.5rem;
            padding:0.65rem 1.25rem; border-radius:var(--radius-sm);
            font-size:0.875rem; font-weight:600; cursor:pointer;
            transition:all 0.2s; border:none; white-space:nowrap;
            font-family:'DM Sans',sans-serif; justify-content:center;
        }
        .btn-primary { background:var(--grad); color:#fff; box-shadow:0 4px 16px var(--primary-glow); }
        .btn-primary:hover { transform:translateY(-1px); box-shadow:0 6px 24px var(--primary-glow); }
        .btn-success { background:var(--grad-success); color:#fff; box-shadow:0 4px 16px var(--success-glow); }
        .btn-success:hover { transform:translateY(-1px); box-shadow:0 6px 24px var(--success-glow); }
        .btn-danger { background:var(--grad-danger); color:#fff; }
        .btn-danger:hover { transform:translateY(-1px); box-shadow:0 6px 24px var(--danger-glow); }
        .btn-ghost {
            background:transparent; border:1px solid var(--border); color:var(--text-dim);
        }
        .btn-ghost:hover { border-color:var(--border-glow); color:var(--text); }
        .btn-sm { padding:0.5rem 0.875rem; font-size:0.8rem; }
        .btn-full { width:100%; }

        /* ── FORM ── */
        .form-wrap { max-width:580px; margin:0 auto; }

        .form-group { margin-bottom:1.125rem; }
        .form-label {
            display:block; font-size:0.8rem; font-weight:600;
            color:var(--text-dim); margin-bottom:0.5rem;
            text-transform:uppercase; letter-spacing:0.04em;
        }
        .form-control {
            width:100%; padding:0.75rem 1rem;
            background:var(--bg-elevated); border:1px solid var(--border);
            border-radius:var(--radius-sm); color:var(--text);
            font-size:0.9rem; font-family:'DM Sans',sans-serif; transition:all 0.2s;
        }
        .form-control:focus {
            outline:none; border-color:var(--primary);
            box-shadow:0 0 0 3px rgba(124,58,237,0.15);
        }
        .form-control::placeholder { color:var(--text-muted); }
        textarea.form-control { min-height:100px; resize:vertical; }

        /* ── UPLOAD ── */
        .upload-zone {
            border:2px dashed rgba(124,58,237,0.25);
            border-radius:var(--radius); padding:2rem 1.5rem;
            text-align:center; cursor:pointer; transition:all 0.25s;
            background:rgba(124,58,237,0.04);
        }
        .upload-zone:hover {
            border-color:var(--primary-light);
            background:rgba(124,58,237,0.08);
        }
        .upload-zone i {
            font-size:2.25rem; color:var(--primary-light);
            margin-bottom:0.75rem; display:block;
        }
        .upload-zone h4 { font-size:0.95rem; margin-bottom:0.25rem; }
        .upload-zone p { font-size:0.8rem; color:var(--text-muted); }

        .upload-preview { margin-top:1rem; }
        .upload-preview img {
            max-width:100%; max-height:260px;
            border-radius:var(--radius-sm); border:1px solid var(--border);
        }

        /* ── EVENT CARD ── */
        .event-card {
            background:var(--bg-elevated); border:1px solid var(--border);
            border-radius:var(--radius); padding:1.125rem;
            margin-bottom:0.875rem; transition:border-color 0.2s;
        }
        .event-card:last-child { margin-bottom:0; }
        .event-card:hover { border-color:var(--border-glow); }

        .event-top {
            display:flex; align-items:center; justify-content:space-between;
            gap:0.5rem; margin-bottom:0.75rem; flex-wrap:wrap;
        }
        .cat-tag {
            display:inline-flex; align-items:center; gap:0.35rem;
            padding:0.25rem 0.625rem;
            background:rgba(124,58,237,0.12); border:1px solid rgba(124,58,237,0.2);
            border-radius:20px; font-size:0.7rem; font-weight:600;
            color:var(--primary-light); text-transform:uppercase;
        }
        .event-q {
            font-size:0.9rem; font-weight:600; color:var(--text);
            margin-bottom:0.75rem; line-height:1.5;
        }
        .event-meta { display:flex; gap:1rem; flex-wrap:wrap; }
        .meta-item {
            display:flex; align-items:center; gap:0.375rem;
            font-size:0.78rem; color:var(--text-muted);
        }
        .meta-item.yes i { color:var(--success); }
        .meta-item.no i { color:var(--danger); }
        .meta-item.pot i { color:var(--primary-light); }

        /* ── BADGE ── */
        .badge {
            display:inline-flex; align-items:center; gap:0.3rem;
            padding:0.3rem 0.7rem; border-radius:20px;
            font-size:0.7rem; font-weight:600;
        }
        .badge::before { content:''; width:5px; height:5px; border-radius:50%; }
        .badge.active { background:rgba(16,185,129,0.12); color:var(--success); }
        .badge.active::before { background:var(--success); }
        .badge.pending { background:rgba(245,158,11,0.12); color:var(--warning); }
        .badge.pending::before { background:var(--warning); }
        .badge.closed, .badge.rejected { background:rgba(244,63,94,0.12); color:var(--danger); }
        .badge.closed::before, .badge.rejected::before { background:var(--danger); }
        .badge.approved { background:rgba(16,185,129,0.12); color:var(--success); }
        .badge.approved::before { background:var(--success); }

        /* ── RESULT MODAL ── */
        .result-opts {
            display:grid; grid-template-columns:1fr 1fr;
            gap:1rem; margin:1.25rem 0;
        }
        .result-opt {
            padding:1.25rem; border-radius:var(--radius);
            border:2px solid var(--border); background:var(--bg-elevated);
            cursor:pointer; text-align:center; transition:all 0.2s;
        }
        .result-opt:hover { border-color:rgba(255,255,255,0.2); transform:translateY(-2px); }
        .result-opt.selected.yes { border-color:var(--success); background:rgba(16,185,129,0.1); }
        .result-opt.selected.no { border-color:var(--danger); background:rgba(244,63,94,0.1); }
        .result-opt i { font-size:1.75rem; margin-bottom:0.5rem; display:block; }
        .result-opt.yes-opt i { color:var(--success); }
        .result-opt.no-opt i { color:var(--danger); }
        .result-opt h4 { font-family:'Syne',sans-serif; font-size:1.1rem; margin-bottom:0.2rem; }
        .result-opt p { font-size:0.75rem; color:var(--text-muted); }

        /* ── MODAL ── */
        .modal-overlay {
            position:fixed; inset:0;
            background:rgba(0,0,0,0.82); display:none;
            align-items:center; justify-content:center;
            z-index:500; backdrop-filter:blur(10px); padding:1rem;
        }
        .modal-overlay.active { display:flex; }

        .modal {
            background:var(--bg-card); border:1px solid var(--border);
            border-radius:var(--radius-lg); padding:1.75rem;
            max-width:520px; width:100%; max-height:90vh;
            overflow-y:auto; scrollbar-width:thin;
            animation:modalIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
        }
        @keyframes modalIn {
            from { opacity:0; transform:scale(0.92) translateY(20px); }
            to   { opacity:1; transform:scale(1) translateY(0); }
        }

        .modal-img-wrap {
            background:var(--bg-card); border:1px solid var(--border);
            border-radius:var(--radius-lg); padding:1rem;
            max-width:90vw; position:relative;
            animation:modalIn 0.3s cubic-bezier(0.34,1.56,0.64,1);
        }
        .modal-image { max-width:100%; max-height:80vh; border-radius:var(--radius-sm); display:block; }

        .modal-header {
            display:flex; align-items:center;
            justify-content:space-between; margin-bottom:1.5rem;
        }
        .modal-title { font-family:'Syne',sans-serif; font-size:1.2rem; font-weight:700; }
        .modal-close {
            width:32px; height:32px; background:var(--bg-elevated);
            border:1px solid var(--border); border-radius:8px;
            color:var(--text-muted); cursor:pointer;
            display:flex; align-items:center; justify-content:center; transition:all 0.2s;
        }
        .modal-close:hover { color:var(--text); border-color:var(--border-glow); }

        /* ── SUMMARY BOX ── */
        .summary-box {
            background:var(--bg-elevated); border:1px solid var(--border);
            border-radius:var(--radius); padding:1rem; margin-bottom:1.25rem;
        }
        .summary-row {
            display:flex; justify-content:space-between; align-items:center;
            padding:0.5rem 0; border-bottom:1px solid var(--border); font-size:0.85rem;
        }
        .summary-row:last-child { border-bottom:none; }
        .summary-key { color:var(--text-muted); }
        .summary-val { font-weight:600; }

        /* ── EMPTY STATE ── */
        .empty {
            text-align:center; padding:3rem 1.5rem; color:var(--text-muted);
        }
        .empty i { font-size:2.5rem; margin-bottom:0.875rem; display:block; opacity:0.4; }
        .empty h4 { font-size:0.95rem; font-weight:600; margin-bottom:0.375rem; color:var(--text-dim); }
        .empty p { font-size:0.8rem; }

        /* ── TOAST ── */
        .toast {
            position:fixed; bottom:1.5rem; right:1.5rem;
            background:var(--bg-elevated); border:1px solid var(--border);
            border-radius:var(--radius); padding:0.875rem 1.25rem;
            display:flex; align-items:center; gap:0.75rem;
            font-size:0.875rem; box-shadow:var(--shadow);
            z-index:9999; max-width:320px;
            transform:translateX(calc(100% + 2rem)); opacity:0;
            transition:all 0.35s cubic-bezier(0.34,1.56,0.64,1);
        }
        .toast.show { transform:translateX(0); opacity:1; }
        .toast.success { border-color:rgba(16,185,129,0.4); }
        .toast.success i { color:var(--success); }
        .toast.error { border-color:rgba(244,63,94,0.4); }
        .toast.error i { color:var(--danger); }

        /* ── SPINNER ── */
        .spin {
            display:inline-block; width:18px; height:18px;
            border:2px solid rgba(255,255,255,0.2);
            border-top-color:#fff; border-radius:50%;
            animation:spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform:rotate(360deg); } }

        /* ── ALERT BANNER ── */
        .alert-banner {
            background:linear-gradient(135deg,rgba(124,58,237,0.12),rgba(244,63,94,0.08));
            border:1px solid var(--border-glow); border-radius:var(--radius);
            padding:0.875rem 1.125rem;
            display:flex; align-items:center; gap:0.75rem;
            margin-bottom:1.25rem; font-size:0.85rem;
        }
        .alert-banner i { color:var(--primary-light); flex-shrink:0; }

        /* ══════════════════════════════════
           RESPONSIVE
        ══════════════════════════════════ */
        @media (max-width: 1024px) {
            .stats-grid { grid-template-columns: repeat(3,1fr); }
        }

        @media (max-width: 900px) {
            :root { --sidebar-w: 0px; }
            .sidebar { width:260px; transform:translateX(-100%); }
            .sidebar.open { transform:translateX(0); }
            .mobile-header { display:flex; }
            .main { margin-left:0; padding-top:var(--header-h); }
            .content { padding:1.25rem; }
            .deposits-grid { grid-template-columns:1fr; }
        }

        @media (max-width: 640px) {
            .stats-grid { grid-template-columns:repeat(3,1fr); gap:0.625rem; }
            .stat-card { padding:0.875rem 0.75rem; gap:0.625rem; flex-direction:column; text-align:center; }
            .stat-icon-wrap { margin:0 auto; }
            .stat-val { font-size:1.1rem; }
            .stat-lbl { font-size:0.68rem; }

            .content { padding:1rem; }
            .card { padding:1rem; }
            .page-title { font-size:1.25rem; }

            .dep-top { flex-direction:column; align-items:flex-start; }
            .dep-amount { align-self:flex-start; }

            .tabs-bar { padding:0.25rem; }
            .tab-btn { font-size:0.72rem; padding:0.5rem 0.625rem; }

            .result-opts { gap:0.75rem; }
            .result-opt { padding:1rem 0.625rem; }

            .toast { bottom:0.875rem; right:0.875rem; left:0.875rem; max-width:unset; }

            .modal { padding:1.25rem; border-radius:var(--radius); }
            .modal-title { font-size:1rem; }
        }

        @media (max-width: 420px) {
            .stats-grid { grid-template-columns:repeat(3,1fr); gap:0.5rem; }
            .stat-val { font-size:0.9rem; }

            .tabs-bar { gap:0.15rem; }
            .tab-btn { font-size:0.68rem; padding:0.45rem 0.5rem; }

            .result-opts { grid-template-columns:1fr; }

            .dep-actions { flex-direction:column; }
            .dep-actions .btn { width:100%; }
        }
    </style>
</head>
<body>

<!-- Mobile Header -->
<header class="mobile-header">
    <div class="mobile-brand">
        <div class="mobile-brand-icon"><i class="fas fa-chart-line"></i></div>
        <div class="mobile-brand-text">Predikta — <span>Anit</span></div>
    </div>
    <button class="icon-btn" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </button>
</header>

<!-- Overlay -->
<div class="overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

<!-- Image Modal -->
<div class="modal-overlay" id="imageModal">
    <div class="modal-img-wrap">
        <button class="modal-close" onclick="closeImageModal()" style="position:absolute;top:0.75rem;right:0.75rem;z-index:1;">
            <i class="fas fa-times"></i>
        </button>
        <img class="modal-image" id="modalImage" src="" alt="Capture">
    </div>
</div>

<!-- Result Modal -->
<div class="modal-overlay" id="resultModal">
    <div class="modal">
        <div class="modal-header">
            <div class="modal-title">Annoncer le résultat</div>
            <button class="modal-close" onclick="closeResultModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="summary-box" id="resultEventSummary"></div>
        <div class="form-group">
            <label class="form-label">Résultat gagnant</label>
            <div class="result-opts">
                <div class="result-opt yes-opt" onclick="selectResult('yes')">
                    <i class="fas fa-check-circle"></i>
                    <h4>OUI</h4>
                    <p>Les parieurs OUI gagnent</p>
                </div>
                <div class="result-opt no-opt" onclick="selectResult('no')">
                    <i class="fas fa-times-circle"></i>
                    <h4>NON</h4>
                    <p>Les parieurs NON gagnent</p>
                </div>
            </div>
        </div>
        <div id="resultPreview" style="display:none;">
            <div class="summary-box">
                <div class="summary-row">
                    <span class="summary-key">Gagnants</span>
                    <span class="summary-val" id="winnersCount" style="color:var(--success);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Perdants</span>
                    <span class="summary-val" id="losersCount" style="color:var(--danger);">0</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Pot redistribué</span>
                    <span class="summary-val" id="redistributionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Commission (2%)</span>
                    <span class="summary-val" id="commissionAmount">0 FCFA</span>
                </div>
                <div class="summary-row">
                    <span class="summary-key">Gain par gagnant</span>
                    <span class="summary-val" id="gainPerWinner" style="color:var(--success);">0 FCFA</span>
                </div>
            </div>
        </div>
        <button class="btn btn-success btn-full" onclick="confirmResult()" id="confirmResultBtn" disabled>
            <i class="fas fa-trophy"></i> Confirmer le résultat
        </button>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMsg">Message</span>
</div>

<div class="layout">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-top">
            <a class="brand" href="#">
                <div class="brand-icon"><i class="fas fa-chart-line"></i></div>
                <div class="brand-name">Predikta <span>Anit</span></div>
            </a>
        </div>

        <nav class="nav">
            <div class="nav-label">Menu</div>
            <a class="nav-link active" onclick="showTab('deposits'); closeSidebar();">
                <div class="icon"><i class="fas fa-money-bill-wave"></i></div>
                Dépôts à valider
            </a>
            <a class="nav-link" onclick="showTab('new-deposit'); closeSidebar();">
                <div class="icon"><i class="fas fa-plus-circle"></i></div>
                Nouveau dépôt
            </a>
            <a class="nav-link" onclick="showTab('events'); closeSidebar();">
                <div class="icon"><i class="fas fa-calendar-alt"></i></div>
                Événements
            </a>
            <a class="nav-link" onclick="showTab('results'); closeSidebar();">
                <div class="icon"><i class="fas fa-trophy"></i></div>
                Résultats
            </a>

            <div class="nav-label">Navigation</div>
            <a class="nav-link back-link" href="predikta-dashboard.html">
                <div class="icon"><i class="fas fa-arrow-left"></i></div>
                Retour au dashboard
            </a>
        </nav>
    </aside>

    <!-- Main -->
    <main class="main">
        <div class="content">

            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Page <span>Anit</span></h1>
                    <div class="page-sub">Gestion des dépôts, événements et résultats</div>
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card purple">
                    <div class="stat-icon-wrap purple"><i class="fas fa-clock"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statPending">0</div>
                        <div class="stat-lbl">En attente</div>
                    </div>
                </div>
                <div class="stat-card green">
                    <div class="stat-icon-wrap green"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statApproved">0</div>
                        <div class="stat-lbl">Approuvés</div>
                    </div>
                </div>
                <div class="stat-card orange">
                    <div class="stat-icon-wrap orange"><i class="fas fa-coins"></i></div>
                    <div class="stat-info">
                        <div class="stat-val" id="statTotal">0</div>
                        <div class="stat-lbl">Total FCFA</div>
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-bar">
                <button class="tab-btn active" onclick="showTab('deposits')">Dépôts</button>
                <button class="tab-btn" onclick="showTab('new-deposit')">Nouveau dépôt</button>
                <button class="tab-btn" onclick="showTab('events')">Événements</button>
                <button class="tab-btn" onclick="showTab('results')">Résultats</button>
            </div>

            <!-- ── Deposits ── -->
            <div class="tab-pane active" id="depositsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-money-bill-wave"></i> Dépôts en attente</div>
                        <button class="btn btn-ghost btn-sm" onclick="loadPendingDeposits()">
                            <i class="fas fa-sync-alt"></i> Actualiser
                        </button>
                    </div>
                    <div class="deposits-grid" id="pendingDepositsList">
                        <div class="empty" style="grid-column:1/-1;">
                            <i class="fas fa-circle-notch fa-spin"></i>
                            <p>Chargement…</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ── New Deposit ── -->
            <div class="tab-pane" id="new-depositPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-plus-circle"></i> Confirmer un dépôt</div>
                    </div>
                    <div class="alert-banner">
                        <i class="fas fa-info-circle"></i>
                        <span>Remplissez ce formulaire pour soumettre un dépôt manuel au nom d'un utilisateur.</span>
                    </div>
                    <form id="depositForm" onsubmit="submitDeposit(event)" class="form-wrap">
                        <div class="form-group">
                            <label class="form-label">Utilisateur *</label>
                            <select class="form-control" id="depositUser" required>
                                <option value="">Sélectionner un utilisateur</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Montant (FCFA) *</label>
                            <input type="number" class="form-control" id="depositAmount" placeholder="Ex: 5000" min="500" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nom complet *</label>
                            <input type="text" class="form-control" id="depositName" placeholder="Nom et prénom" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Contact *</label>
                            <input type="tel" class="form-control" id="depositContact" placeholder="Numéro de téléphone" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Capture d'écran *</label>
                            <div class="upload-zone" onclick="openCloudinaryWidget()">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Cliquez pour uploader</h4>
                                <p>PNG, JPG ou WEBP acceptés</p>
                            </div>
                            <div class="upload-preview" id="uploadPreview" style="display:none;">
                                <img id="previewImage" src="" alt="Preview">
                            </div>
                            <input type="hidden" id="screenshotUrl">
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="submitDepositBtn">
                            <i class="fas fa-paper-plane"></i> Soumettre le dépôt
                        </button>
                    </form>
                </div>
            </div>

            <!-- ── Events ── -->
            <div class="tab-pane" id="eventsPane">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-calendar-alt"></i> Publier un événement</div>
                    </div>
                    <form id="eventForm" onsubmit="publishEvent(event)" class="form-wrap">
                        <div class="form-group">
                            <label class="form-label">Question *</label>
                            <input type="text" class="form-control" id="eventQuestion" placeholder="Ex: Le Sénégal va-t-il gagner la CAN 2024 ?" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Catégorie *</label>
                            <select class="form-control" id="eventCategory" required>
                                <option value="sport">Sport</option>
                                <option value="politique">Politique</option>
                                <option value="entertainment">Divertissement</option>
                                <option value="crypto">Crypto</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mise minimale (FCFA) *</label>
                            <input type="number" class="form-control" id="eventMinBet" value="100" min="100" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date de clôture *</label>
                            <input type="datetime-local" class="form-control" id="eventEndDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description (optionnel)</label>
                            <textarea class="form-control" id="eventDescription" placeholder="Description détaillée…"></textarea>
                        </div>
                        <button type="submit" class="btn btn-success btn-full" id="publishEventBtn">
                            <i class="fas fa-calendar-plus"></i> Publier l'événement
                        </button>
                    </form>
                </div>
            </div>

            <!-- ── Results ── -->
            <div class="tab-pane" id="resultsPane">
                <div class="card" style="margin-bottom:1.25rem;">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-trophy"></i> Événements en attente de résultat</div>
                    </div>
                    <div id="pendingResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><i class="fas fa-history"></i> Résultats annoncés</div>
                    </div>
                    <div id="announcedResultsList">
                        <div class="empty"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>
                    </div>
                </div>
            </div>

        </div><!-- /content -->
    </main>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCPGgtXoDUycykLaTSee0S0yY0tkeJpqKI",
        authDomain: "data-com-a94a8.firebaseapp.com",
        databaseURL: "https://data-com-a94a8-default-rtdb.firebaseio.com",
        projectId: "data-com-a94a8",
        storageBucket: "data-com-a94a8.firebasestorage.app",
        messagingSenderId: "276904640935",
        appId: "1:276904640935:web:9cd805aeba6c34c767f682",
        measurementId: "G-FYQCWY5G4S"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const cloudinaryConfig = { cloudName:'djxcqczh1', uploadPreset:'database' };

    let uploadedImageUrl = '';
    let currentResultEvent = null;
    let selectedResult = null;

    // ── Sidebar ──
    function toggleSidebar() {
        document.getElementById('sidebar').classList.toggle('open');
        document.getElementById('sidebarOverlay').classList.toggle('active');
    }
    function closeSidebar() {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('sidebarOverlay').classList.remove('active');
    }

    // ── Tabs ──
    function showTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        const tabNames = ['deposits','new-deposit','events','results'];
        const idx = tabNames.indexOf(tab);
        const btns = document.querySelectorAll('.tab-btn');
        if (idx >= 0 && btns[idx]) btns[idx].classList.add('active');

        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));

        // Map tab name to pane id (new-deposit → new-depositPane)
        const pane = document.getElementById(tab + 'Pane');
        if (pane) pane.classList.add('active');

        if (tab === 'deposits') { loadPendingDeposits(); updateStats(); }
        if (tab === 'results') { loadPendingResults(); loadAnnouncedResults(); }
    }

    // ── Init ──
    document.addEventListener('DOMContentLoaded', () => {
        loadPendingDeposits();
        loadUserSelect();
        updateStats();
        loadPendingResults();
        loadAnnouncedResults();
        const d = new Date();
        d.setDate(d.getDate() + 7);
        d.setMinutes(d.getMinutes() - d.getTimezoneOffset());
        document.getElementById('eventEndDate').value = d.toISOString().slice(0, 16);
    });

    // ── Helpers ──
    function fmt(n) { return (n||0).toLocaleString(); }

    function getCatIcon(cat) {
        return {sport:'futbol',politique:'landmark',entertainment:'film',crypto:'bitcoin',autre:'tag'}[cat]||'tag';
    }

    function showToast(msg, type='success') {
        const t = document.getElementById('toast');
        t.querySelector('i').className = type === 'success' ? 'fas fa-check-circle' : 'fas fa-exclamation-circle';
        document.getElementById('toastMsg').textContent = msg;
        t.className = 'toast show ' + type;
        setTimeout(() => t.classList.remove('show'), 3500);
    }

    // ── Stats ──
    function updateStats() {
        db.collection('deposit_requests').where('status','==','pending').get()
            .then(s => document.getElementById('statPending').textContent = s.size);
        db.collection('deposit_requests').where('status','==','approved').get()
            .then(s => {
                document.getElementById('statApproved').textContent = s.size;
                let total = 0;
                s.forEach(d => total += d.data().amount || 0);
                document.getElementById('statTotal').textContent = fmt(total);
            });
    }

    // ── Pending Deposits ──
    function loadPendingDeposits() {
        const container = document.getElementById('pendingDepositsList');
        container.innerHTML = '<div class="empty" style="grid-column:1/-1;"><i class="fas fa-circle-notch fa-spin"></i><p>Chargement…</p></div>';

        db.collection('deposit_requests').where('status','==','pending').get()
            .then(snap => {
                if (snap.empty) {
                    container.innerHTML = '<div class="empty" style="grid-column:1/-1;"><i class="fas fa-check-circle" style="opacity:1;color:var(--success);"></i><h4>Aucun dépôt en attente</h4><p>Tous les dépôts ont été traités</p></div>';
                    return;
                }
                let deps = snap.docs.map(d=>({id:d.id,...d.data()}))
                    .sort((a,b)=>(b.createdAt?.toMillis()||0)-(a.createdAt?.toMillis()||0));

                container.innerHTML = deps.map(dep => {
                    const name = dep.userName || 'Inconnu';
                    const initials = name.split(' ').map(n=>n[0]||'').join('').toUpperCase().slice(0,2);
                    const date = dep.createdAt ? dep.createdAt.toDate().toLocaleDateString('fr-FR') : '-';
                    return `
                    <div class="dep-card">
                        <div class="dep-top">
                            <div class="dep-user">
                                <div class="dep-avatar">${initials}</div>
                                <div class="dep-user-info">
                                    <div class="dep-name">${name}</div>
                                    <div class="dep-email">${dep.userEmail||'Pas d\'email'}</div>
                                </div>
                            </div>
                            <div class="dep-amount">+${fmt(dep.amount)} FCFA</div>
                        </div>
                        <div class="dep-details">
                            <div class="dep-detail">
                                <span class="dep-key">Téléphone</span>
                                <span class="dep-val">${dep.phone||'-'}</span>
                            </div>
                            <div class="dep-detail">
                                <span class="dep-key">Date</span>
                                <span class="dep-val">${date}</span>
                            </div>
                            ${dep.comment ? `<div class="dep-detail"><span class="dep-key">Commentaire</span><span class="dep-val">${dep.comment}</span></div>` : ''}
                            <div class="dep-detail">
                                <span class="dep-key">Statut</span>
                                <span class="badge pending">En attente</span>
                            </div>
                        </div>
                        ${dep.screenshotURL ? `<img src="${dep.screenshotURL}" class="dep-screenshot" onclick="openImageModal('${dep.screenshotURL}')" alt="Capture">` : ''}
                        <div class="dep-actions">
                            <button class="btn btn-success" onclick="approveDeposit('${dep.id}')">
                                <i class="fas fa-check"></i> Approuver
                            </button>
                            <button class="btn btn-danger" onclick="rejectDeposit('${dep.id}')">
                                <i class="fas fa-times"></i> Rejeter
                            </button>
                        </div>
                    </div>`;
                }).join('');
            })
            .catch(err => {
                container.innerHTML = `<div class="empty" style="grid-column:1/-1;"><i class="fas fa-exclamation-triangle"></i><h4>Erreur</h4><p>${err.message}</p></div>`;
            });
    }

    // ── User Select ──
    function loadUserSelect() {
        db.collection('users').get().then(snap => {
            const sel = document.getElementById('depositUser');
            snap.forEach(doc => {
                const u = doc.data();
                const opt = document.createElement('option');
                opt.value = doc.id;
                opt.textContent = `${u.prenom} ${u.nom} (@${u.pseudo})`;
                sel.appendChild(opt);
            });
        });
    }

    // ── Cloudinary ──
    function openCloudinaryWidget() {
        cloudinary.openUploadWidget({
            cloudName: cloudinaryConfig.cloudName,
            uploadPreset: cloudinaryConfig.uploadPreset,
            sources: ['local','url','camera'],
            multiple: false, maxFiles: 1,
            cropping: false, resourceType: 'image',
            styles: {
                palette: {
                    window:'#0d0f1e', windowBorder:'#7c3aed',
                    tabIcon:'#a855f7', menuIcons:'#6b7094',
                    textDark:'#f0f0ff', textLight:'#f0f0ff',
                    link:'#7c3aed', action:'#7c3aed',
                    inactiveTabIcon:'#6b7094', error:'#f43f5e',
                    inProgress:'#7c3aed', complete:'#10b981',
                    sourceBg:'#121428'
                }
            }
        }, (error, result) => {
            if (!error && result && result.event === 'success') {
                uploadedImageUrl = result.info.secure_url;
                document.getElementById('screenshotUrl').value = uploadedImageUrl;
                document.getElementById('previewImage').src = uploadedImageUrl;
                document.getElementById('uploadPreview').style.display = 'block';
                showToast('Image uploadée !', 'success');
            }
        });
    }

    // ── Submit Deposit ──
    function submitDeposit(e) {
        e.preventDefault();
        const btn = document.getElementById('submitDepositBtn');
        btn.innerHTML = '<span class="spin"></span> Soumission…'; btn.disabled = true;

        const userId = document.getElementById('depositUser').value;
        const amount = parseInt(document.getElementById('depositAmount').value);
        const name   = document.getElementById('depositName').value;
        const contact= document.getElementById('depositContact').value;
        const screenshot = document.getElementById('screenshotUrl').value;

        if (!userId) { showToast('Veuillez sélectionner un utilisateur','error'); btn.innerHTML='<i class="fas fa-paper-plane"></i> Soumettre le dépôt'; btn.disabled=false; return; }
        if (!screenshot) { showToast('Veuillez uploader une capture d\'écran','error'); btn.innerHTML='<i class="fas fa-paper-plane"></i> Soumettre le dépôt'; btn.disabled=false; return; }

        db.collection('users').doc(userId).get()
            .then(doc => {
                const u = doc.data();
                return db.collection('deposit_requests').add({
                    userId, amount,
                    userName: u ? `${u.prenom} ${u.nom}` : name,
                    userEmail: u?.email || null,
                    phone: contact, screenshotURL: screenshot,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            })
            .then(() => {
                showToast('Dépôt soumis avec succès !', 'success');
                document.getElementById('depositForm').reset();
                document.getElementById('uploadPreview').style.display = 'none';
                uploadedImageUrl = '';
                loadPendingDeposits(); updateStats();
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Soumettre le dépôt'; btn.disabled = false;
            })
            .catch(err => {
                showToast('Erreur: ' + err.message, 'error');
                btn.innerHTML = '<i class="fas fa-paper-plane"></i> Soumettre le dépôt'; btn.disabled = false;
            });
    }

    // ── Approve / Reject ──
    function approveDeposit(id) {
        if (!confirm('Approuver ce dépôt ?')) return;
        db.collection('deposit_requests').doc(id).get().then(doc => {
            const dep = doc.data();
            const batch = db.batch();
            batch.update(doc.ref, { status:'approved', processedAt:firebase.firestore.FieldValue.serverTimestamp() });
            batch.update(db.collection('users').doc(dep.userId), { balance:firebase.firestore.FieldValue.increment(dep.amount) });
            return batch.commit();
        }).then(() => {
            showToast('Dépôt approuvé ! Solde mis à jour.', 'success');
            loadPendingDeposits(); updateStats();
        }).catch(err => showToast('Erreur: ' + err.message, 'error'));
    }

    function rejectDeposit(id) {
        if (!confirm('Rejeter ce dépôt ?')) return;
        db.collection('deposit_requests').doc(id).update({
            status:'rejected', processedAt:firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            showToast('Dépôt rejeté', 'success');
            loadPendingDeposits(); updateStats();
        }).catch(err => showToast('Erreur: ' + err.message, 'error'));
    }

    // ── Publish Event ──
    function publishEvent(e) {
        e.preventDefault();
        const btn = document.getElementById('publishEventBtn');
        btn.innerHTML = '<span class="spin"></span> Publication…'; btn.disabled = true;
        db.collection('events').add({
            question:    document.getElementById('eventQuestion').value,
            category:    document.getElementById('eventCategory').value,
            minBet:      parseInt(document.getElementById('eventMinBet').value),
            endDate:     document.getElementById('eventEndDate').value,
            description: document.getElementById('eventDescription').value,
            status:'active', bets:[],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
            showToast('Événement publié !', 'success');
            document.getElementById('eventForm').reset();
            const d = new Date(); d.setDate(d.getDate()+7);
            d.setMinutes(d.getMinutes()-d.getTimezoneOffset());
            document.getElementById('eventEndDate').value = d.toISOString().slice(0,16);
            btn.innerHTML = '<i class="fas fa-calendar-plus"></i> Publier l\'événement'; btn.disabled = false;
            loadPendingResults();
        }).catch(err => {
            showToast('Erreur: ' + err.message, 'error');
            btn.innerHTML = '<i class="fas fa-calendar-plus"></i> Publier l\'événement'; btn.disabled = false;
        });
    }

    // ── Pending Results ──
    function loadPendingResults() {
        db.collection('events').where('status','==','active').get().then(snap => {
            const c = document.getElementById('pendingResultsList');
            if (snap.empty) {
                c.innerHTML = '<div class="empty"><i class="fas fa-check-circle" style="opacity:1;color:var(--success);"></i><h4>Aucun événement en attente</h4><p>Tous les résultats ont été annoncés</p></div>';
                return;
            }
            let events = snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.createdAt?.toMillis()||0)-(a.createdAt?.toMillis()||0));
            c.innerHTML = events.map(ev => {
                const yes=(ev.bets||[]).filter(b=>b.choice==='yes');
                const no=(ev.bets||[]).filter(b=>b.choice==='no');
                const pot=(ev.bets||[]).reduce((s,b)=>s+b.amount,0);
                return `
                <div class="event-card">
                    <div class="event-top">
                        <span class="cat-tag"><i class="fas fa-${getCatIcon(ev.category)}"></i> ${ev.category||'sport'}</span>
                        <span class="badge active">En cours</span>
                    </div>
                    <div class="event-q">${ev.question}</div>
                    <div class="event-meta" style="margin-bottom:0.875rem;">
                        <span class="meta-item yes"><i class="fas fa-check-circle"></i> ${yes.length} OUI (${fmt(yes.reduce((s,b)=>s+b.amount,0))} FCFA)</span>
                        <span class="meta-item no"><i class="fas fa-times-circle"></i> ${no.length} NON (${fmt(no.reduce((s,b)=>s+b.amount,0))} FCFA)</span>
                        <span class="meta-item pot"><i class="fas fa-coins"></i> ${fmt(pot)} FCFA</span>
                    </div>
                    <button class="btn btn-success btn-full" onclick="openResultModal('${ev.id}')">
                        <i class="fas fa-trophy"></i> Annoncer le résultat
                    </button>
                </div>`;
            }).join('');
        }).catch(err => {
            document.getElementById('pendingResultsList').innerHTML = `<div class="empty"><i class="fas fa-exclamation-triangle"></i><h4>Erreur</h4><p>${err.message}</p></div>`;
        });
    }

    // ── Announced Results ──
    function loadAnnouncedResults() {
        db.collection('events').where('status','==','closed').get().then(snap => {
            const c = document.getElementById('announcedResultsList');
            if (snap.empty) {
                c.innerHTML = '<div class="empty"><i class="fas fa-history"></i><h4>Aucun résultat annoncé</h4><p>Les résultats apparaîtront ici</p></div>';
                return;
            }
            let events = snap.docs.map(d=>({id:d.id,...d.data()})).sort((a,b)=>(b.closedAt?.toMillis()||0)-(a.closedAt?.toMillis()||0));
            c.innerHTML = events.map(ev => {
                const yes=(ev.bets||[]).filter(b=>b.choice==='yes');
                const no=(ev.bets||[]).filter(b=>b.choice==='no');
                const winners=ev.winner==='yes'?yes:no;
                const losers=ev.winner==='yes'?no:yes;
                const loserTotal=losers.reduce((s,b)=>s+b.amount,0);
                const comm=loserTotal*0.02;
                const gain=winners.length?(loserTotal-comm)/winners.length:0;
                return `
                <div class="event-card" style="border-left:3px solid ${ev.winner==='yes'?'var(--success)':'var(--danger)'};">
                    <div class="event-top">
                        <span class="cat-tag"><i class="fas fa-${getCatIcon(ev.category)}"></i> ${ev.category||'sport'}</span>
                        <span class="badge closed">Terminé</span>
                    </div>
                    <div class="event-q">${ev.question}</div>
                    <div class="summary-box" style="margin-top:0.75rem;">
                        <div class="summary-row">
                            <span class="summary-key">Résultat</span>
                            <span class="summary-val" style="color:${ev.winner==='yes'?'var(--success)':'var(--danger)'};">${ev.winner==='yes'?'OUI':'NON'}</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-key">Gagnants</span>
                            <span class="summary-val" style="color:var(--success);">${winners.length} personnes</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-key">Perdants</span>
                            <span class="summary-val" style="color:var(--danger);">${losers.length} personnes</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-key">Gain/gagnant</span>
                            <span class="summary-val" style="color:var(--success);">+${fmt(Math.floor(gain))} FCFA</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }).catch(err => {
            document.getElementById('announcedResultsList').innerHTML = `<div class="empty"><i class="fas fa-exclamation-triangle"></i><h4>Erreur</h4><p>${err.message}</p></div>`;
        });
    }

    // ── Result Modal ──
    function openResultModal(eventId) {
        db.collection('events').doc(eventId).get().then(doc => {
            if (!doc.exists) { showToast('Événement introuvable','error'); return; }
            currentResultEvent = { id:doc.id, ...doc.data() };
            selectedResult = null;
            const yes=(currentResultEvent.bets||[]).filter(b=>b.choice==='yes');
            const no=(currentResultEvent.bets||[]).filter(b=>b.choice==='no');
            const yesT=yes.reduce((s,b)=>s+b.amount,0);
            const noT=no.reduce((s,b)=>s+b.amount,0);
            document.getElementById('resultEventSummary').innerHTML = `
                <div class="summary-row"><span class="summary-key">Question</span><span class="summary-val" style="max-width:60%;text-align:right;">${currentResultEvent.question}</span></div>
                <div class="summary-row"><span class="summary-key">Paris OUI</span><span class="summary-val" style="color:var(--success);">${yes.length} (${fmt(yesT)} FCFA)</span></div>
                <div class="summary-row"><span class="summary-key">Paris NON</span><span class="summary-val" style="color:var(--danger);">${no.length} (${fmt(noT)} FCFA)</span></div>
                <div class="summary-row"><span class="summary-key">Pot total</span><span class="summary-val">${fmt(yesT+noT)} FCFA</span></div>`;
            document.querySelectorAll('.result-opt').forEach(el=>el.classList.remove('selected','yes','no'));
            document.getElementById('resultPreview').style.display = 'none';
            document.getElementById('confirmResultBtn').disabled = true;
            document.getElementById('resultModal').classList.add('active');
        }).catch(err => showToast('Erreur: '+err.message,'error'));
    }

    function closeResultModal() {
        document.getElementById('resultModal').classList.remove('active');
        currentResultEvent = null; selectedResult = null;
    }

    function selectResult(result) {
        selectedResult = result;
        document.querySelectorAll('.result-opt').forEach(el=>el.classList.remove('selected','yes','no'));
        document.querySelector(`.result-opt.${result}-opt`).classList.add('selected', result);
        const yes=(currentResultEvent.bets||[]).filter(b=>b.choice==='yes');
        const no=(currentResultEvent.bets||[]).filter(b=>b.choice==='no');
        const winners=result==='yes'?yes:no;
        const losers=result==='yes'?no:yes;
        const loserTotal=losers.reduce((s,b)=>s+b.amount,0);
        const comm=loserTotal*0.02;
        const redist=loserTotal-comm;
        const gain=winners.length?redist/winners.length:0;
        document.getElementById('winnersCount').textContent=winners.length;
        document.getElementById('losersCount').textContent=losers.length;
        document.getElementById('redistributionAmount').textContent=fmt(Math.floor(redist))+' FCFA';
        document.getElementById('commissionAmount').textContent=fmt(Math.floor(comm))+' FCFA';
        document.getElementById('gainPerWinner').textContent='+'+fmt(Math.floor(gain))+' FCFA';
        document.getElementById('resultPreview').style.display='block';
        document.getElementById('confirmResultBtn').disabled=false;
    }

    function confirmResult() {
        if (!selectedResult||!currentResultEvent) return;
        const btn = document.getElementById('confirmResultBtn');
        btn.innerHTML = '<span class="spin"></span> Traitement…'; btn.disabled = true;
        const yes=(currentResultEvent.bets||[]).filter(b=>b.choice==='yes');
        const no=(currentResultEvent.bets||[]).filter(b=>b.choice==='no');
        const winners=selectedResult==='yes'?yes:no;
        const losers=selectedResult==='yes'?no:yes;
        const loserTotal=losers.reduce((s,b)=>s+b.amount,0);
        const comm=loserTotal*0.02;
        const redist=loserTotal-comm;
        const gain=winners.length?redist/winners.length:0;
        const batch=db.batch();
        batch.update(db.collection('events').doc(currentResultEvent.id),{
            status:'closed', winner:selectedResult,
            closedAt:firebase.firestore.FieldValue.serverTimestamp(),
            commission:comm, redistribution:redist
        });
        winners.forEach(wb => {
            batch.update(db.collection('users').doc(wb.userId),{balance:firebase.firestore.FieldValue.increment(wb.amount+gain)});
        });
        batch.commit().then(() => {
            showToast('Résultat annoncé ! Gains distribués.','success');
            closeResultModal(); loadPendingResults(); loadAnnouncedResults();
            btn.innerHTML='<i class="fas fa-trophy"></i> Confirmer le résultat'; btn.disabled=false;
        }).catch(err => {
            showToast('Erreur: '+err.message,'error');
            btn.innerHTML='<i class="fas fa-trophy"></i> Confirmer le résultat'; btn.disabled=false;
        });
    }

    // ── Image Modal ──
    function openImageModal(src) {
        document.getElementById('modalImage').src = src;
        document.getElementById('imageModal').classList.add('active');
    }
    function closeImageModal() {
        document.getElementById('imageModal').classList.remove('active');
    }
</script>
</body>
</html>
